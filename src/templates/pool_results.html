{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block content %}

<form method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
</form>
<div class="container">
    <h2>Pool Results</h2>
    <table class="table table-striped">
        <thead class="thead-light">
            <tr>
                {% for user in users %}
                <th class="user" scope="col">{{ user }}</th>
                <th scope="col">pts</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
        {% for round in pool_picks %}

            <tr>
                {% for driver in round %}
                <td class="null">{{ driver['car_num'] }} - {{ driver['drv_full'] }}</td>
                <td class="{{ driver['username'] }}">{{ driver['position']  }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
            <tr>
                {% for user in users %}
                <td class="total_pts"><b>Total</b></td>
                <td class="{{ user  }}_tot"><b>0</b></td>
                {% endfor %}
            </tr>
        </tbody>

</div>


<script>
$(document).ready(function() {
     var userpoints = {};
    $('th').each(function() {
        userpoints[$(this).text()] = 0;
        console.log("bob value " + userpoints['bob']);
    });
    $('td').each(function() {
        var i = $(this).attr('class');
        if (i != 'null') {
            console.log("value i is " + i);
            console.log(userpoints[i]);
            console.log($(this).text());
            userpoints[i] = userpoints[i] += parseInt($(this).text())
            }
    $('td').each(function() {
        var i_tot = $(this).attr('class') + "_tot";
        var i = $(this).attr('class');
        if ($(this).attr('class') == i_tot)  {
            console.log(userpoints[i])
            $(this).text(userpoints[i]);
        }
    });


    for(var key in userpoints) {
            var value = userpoints[key];
            console.log(key + "=" + value);
        }

});

</script>
{% endblock %}